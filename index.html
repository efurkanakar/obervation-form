<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Observation Form</title>
    <style>
        /* Genel stil ayarları */
        body {
            font-family: "Gill Sans", sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        .container {
            width: 98%;
            max-width: 1600px;
            min-width: 300px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            color: #333;
            margin: 0;
            padding: 20px;
            text-align: center;
            background-color: #e9ecef;
            border-bottom: 1px solid #ccc;
        }
        .section {
            padding: 30px;
            margin: 20px 0;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        label {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 13px;
        }
        input, select {
            width: 100%;
            padding: 8px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 12px;
        }
        .button.small-button {
            background-color: #28a745;
            color: white;
            padding: 12px 12px;
            font-size: 12px;
            font-weight: normal;
            width: 80px;
            max-width: 80px;
            border-radius: 5px;
            border: 0px solid #28a745;
            transition: background-color 0.2s ease;
        }
        .button.small-button:hover {
            background-color: #218838;
            border-color: #1e7e34;
        }
        .button-row {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        .date-observation-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }
        .date-column, .observation-column, .telescope-column {
            width: 30%;
        }
        .observation-column {
            display: flex;
            flex-direction: column;
        }
        .radio-group {
            display: inline-flex;
            gap: 10px;
            align-items: center;
        }
        .radio-group label {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .row {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: nowrap;
        }
        .input-container-special {
            flex: 1 1 13%;
        }
        .input-container-wide {
            flex: 1 1 20%; 
        }
        .input-container-large {
            flex: 1 1 100%;
        }
        .hidden {
            display: none;
        }
        .error {
            color: red;
            font-size: 12px;
            margin-bottom: 10px;
        }
    </style>
    <!-- EmailJS kütüphanesini ekliyoruz -->
    <script type="text/javascript" src="https://cdn.emailjs.com/dist/email.min.js"></script>
    <script type="text/javascript">
        window.onload = function() {
            // EmailJS başlatılıyor
            emailjs.init("SPZ4gMRCG9sHemlE7");

            var now = new Date();
            var formattedDate = now.toISOString().slice(0, 10); 
            document.getElementById('observation_date').value = formattedDate;

            // Evet hayır alanları için listener
            document.getElementById('observation_done_yes').addEventListener('change', function() {
                document.getElementById('yes_fields').classList.remove('hidden');
                document.getElementById('no_fields').classList.add('hidden');
                document.getElementById('submit_button').classList.remove('hidden');
                addStarField(); // İlk tıklamada yıldız alanı ekleniyor
            });

            document.getElementById('observation_done_no').addEventListener('change', function() {
                document.getElementById('yes_fields').classList.add('hidden');
                document.getElementById('no_fields').classList.remove('hidden');
                document.getElementById('submit_button').classList.remove('hidden');
            });

            // Form submit işlemi
            document.getElementById('observationForm').addEventListener('submit', function(event) {
                event.preventDefault(); // Otomatik form submit'i durduruluyor
                sendMail(); // EmailJS ile formu gönder
            });
        };

        function sendMail() {
            var form = document.getElementById('observationForm');

            // Form verilerini EmailJS ile gönderiyoruz
            emailjs.sendForm('service_r7cv4z9', 'template_ah4hbac', form)
                .then(function(response) {
                    console.log('SUCCESS!', response.status, response.text);
                    alert("Form successfully submitted!");
                }, function(error) {
                    console.log('FAILED...', error);
                    alert("Failed to send the form. Please try again.");
                });
        }

        function addStarField() {
            const starContainer = document.getElementById('stars_container');
            const newStarField = document.createElement('div');
            newStarField.classList.add('row');
            newStarField.innerHTML = `
                <div class="input-container-wide">
                    <label for="observed_stars">Object Name <span class="required-star">*</span></label>
                    <input type="text" name="observed_stars[]" class="small-input" placeholder="Enter star" required>
                </div>

                <div class="input-container-special">
                    <label for="filter">Filter <span class="required-star">*</span></label>
                    <input list="filters" name="filter" placeholder="Enter filter" required>
                    <datalist id="filters">
                        <option value="SDSS-u'">
                        <option value="SDSS-g'">
                        <option value="SDSS-r'">
                        <option value="SDSS-i'">
                        <option value="SDSS-z'">
                        <option value="Clear">
                        <option value="Bessel-B">
                        <option value="Bessel-V">
                        <option value="Bessel-R">
                        <option value="Bessel-I">
                    </datalist>
                </div>

                <div class="input-container-special">
                    <label for="exposure_time">Exposure Time <span class="required-star">*</span></label>
                    <input list="exposure_times" name="exposure_time" placeholder="Enter exposure time" required>
                    <datalist id="exposure_times">
                        <option value="5s">
                        <option value="10s">
                        <option value="20s">
                        <option value="30s">
                        <option value="60s">
                    </datalist>
                </div>

                <div class="input-container-special">
                    <label for="binning">Binning <span class="required-star">*</span></label>
                    <input list="binnings" name="binning" placeholder="Enter binning" required>
                    <datalist id="binnings">
                        <option value="1x1">
                        <option value="2x2">
                        <option value="3x3">
                        <option value="4x4">
                    </datalist>
                </div>

                <div class="input-container-special">
                    <label for="sky_condition">Sky Condition <span class="required-star">*</span></label>
                    <input list="sky_conditions" name="sky_condition" placeholder="Enter sky condition" required>
                    <datalist id="sky_conditions">
                        <option value="Cloudy">
                        <option value="Partly Cloudy">
                        <option value="Clear">
                        <option value="Transparent">
                    </datalist>
                </div>

                <div class="input-container-wide"> 
                    <label for="file_link">Preliminary Result</label>
                    <input type="text" name="file_link[]" class="small-input" placeholder="Paste file link here">
                </div>
            `;
            starContainer.appendChild(newStarField);
        }
    </script>
</head>
<body>

    <div class="container">
        <h1>Observation Info</h1>

        <form id="observationForm">
            <div class="section">
                <div class="date-observation-row">
                    <div class="date-column">
                        <label for="observation_date">Date</label>
                        <input type="date" id="observation_date" name="observation_date" required>
                    </div>

                    <div class="telescope-column">
                        <label for="telescope_used">Telescope Used</label>
                        <select name="telescope_used" required>
                            <option value="T35">T35</option>
                            <option value="T80">T80</option>
                            <option value="T100">T100</option>
                        </select>
                    </div>

                    <div class="observation-column">
                        <label for="observation_done">Was the observation done?</label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" id="observation_done_yes" name="observation_done" value="yes" required> Yes
                            </label>
                            <label>
                                <input type="radio" id="observation_done_no" name="observation_done" value="no" required> No
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div id="yes_fields" class="hidden">
                <div class="section">
                    <label for="observer_name">Observer Name <span class="required-star">*</span></label>
                    <input type="text" id="observer_name" name="observer_name" required placeholder="Enter observer name">

                    <div id="stars_container"></div>

                    <div class="button-row">
                        <button type="button" class="button small-button" onclick="addStarField()">Add</button>
                    </div>
                </div>
            </div>

            <div id="no_fields" class="hidden">
                <div class="section">
                    <label for="observer_name_no">Observer Name <span class="required-star">*</span></label>
                    <input type="text" id="observer_name_no" name="observer_name_no" placeholder="Enter observer name(s)" required>
                    <label style="margin-bottom: 15px;">Please select the reason for not doing the observation <span class="required-star">*</span></label>
                    <div style="display: flex; justify-content: space-between; flex-wrap: wrap; gap: 20px; width: 100%;">
                        <label style="display: flex; align-items: center; gap: 10px; width: 200px;">
                            <input type="checkbox" name="reason_weather" value="Cloudy weather" style="width: auto; margin: 0;">
                            <span>Cloudy Weather</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; width: 200px;">
                            <input type="checkbox" name="reason_wind" value="Strong wind" style="width: auto; margin: 0;">
                            <span>Strong wind</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; width: 200px;">
                            <input type="checkbox" name="reason_humidity" value="High humidity" style="width: auto; margin: 0;">
                            <span>High humidity</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 10px; width: 200px;">
                            <input type="checkbox" name="reason_technical" value="Technical issue" style="width: auto; margin: 0;">
                            <span>Technical issue</span>
                        </label>
                    </div>
                    <input type="text" name="other_reason_text" placeholder="Other reason" style="margin-top: 10px;">

                    <div class="input-container">
                        <label for="additional_info">Additional Info</label>
                        <input type="text" id="additional_info" name="additional_info" placeholder="If there is any additional information, please write it here." required>
                    </div>
                </div>
            </div>

            <!-- Submit Butonu -->
            <div class="button-row">
                <input type="submit" class="button small-button hidden" id="submit_button" value="Submit">
            </div>
        </form>
    </div>
</body>
</html>
